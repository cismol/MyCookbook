<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Recipe Book</title>
    <link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>
<header>
    <h1>My Cookbook</h1>
    <div class="search-bar">
        <input type="text" id="searchInput" class="search-input" placeholder="Search recipes...">
        <button id="searchButton">Search</button>
    </div>
    <nav>
        <a href="#">Home</a>
        <a href="#">Recipes</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
    </nav>
</header>

<div class="edit-form" id="editForm" style="display: none;">
    <h2>Edit Recipe</h2>
    <input type="text" id="editRecipeTitle" placeholder="Title">
    <textarea id="editRecipeDescription" placeholder="Description"></textarea>
    <button id="saveEditButton">Save Changes</button>
</div>

<div id="recipeList"></div>

<div class="upload-form">
    <h2>Add New Recipe</h2>
    <input type="text" id="newRecipeTitle" placeholder="Title">
    <textarea id="newRecipeDescription" placeholder="Description"></textarea>
    <button id="uploadRecipeButton">Upload Recipe</button>
</div>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyDxvabrO3eNRTm37fE7G7sxckZBJrrnpHQ",
        authDomain: "mycookbook-ee7d2.firebaseapp.com",
        projectId: "mycookbook-ee7d2",
        storageBucket: "mycookbook-ee7d2.appspot.com",
        messagingSenderId: "49507480622",
        appId: "1:49507480622:web:679369b3d9568dc15adbbf",
        measurementId: "G-1MXN7NP98K"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById('uploadRecipeButton').addEventListener('click', addRecipe);
	document.getElementById('searchButton').addEventListener('click', () => fetchRecipes(document.getElementById('searchInput').value.trim()));


    async function addRecipe() {
        const title = document.getElementById('newRecipeTitle').value.trim();
        const description = document.getElementById('newRecipeDescription').value.trim();
        if (title && description) {
            try {
                await addDoc(collection(db, "recipes"), { title, description });
                fetchRecipes();
                document.getElementById('newRecipeTitle').value = '';
                document.getElementById('newRecipeDescription').value = '';
                alert('Recipe added successfully!');
            } catch (error) {
                console.error("Error adding recipe: ", error);
                alert('Failed to add recipe.');
            }
        } else {
            alert('Title and description are required.');
        }
    }

    document.getElementById('saveEditButton').addEventListener('click', async function() {
        const docId = this.getAttribute('data-id');
        const updatedTitle = document.getElementById('editRecipeTitle').value.trim();
        const updatedDescription = document.getElementById('editRecipeDescription').value.trim();

        if (!updatedTitle || !updatedDescription) {
            alert('Both title and description must be filled out.');
            return;
        }

        const docRef = doc(db, "recipes", docId);
        try {
            await updateDoc(docRef, {
                title: updatedTitle,
                description: updatedDescription
            });
            document.getElementById('editForm').style.display = 'none';
            fetchRecipes();
            alert('Recipe updated successfully!');
        } catch (error) {
            console.error("Error updating recipe: ", error);
            alert('Failed to update recipe.');
        }
    });

    async function fetchRecipes(searchTerm = "") {
        const recipesCollectionRef = collection(db, 'recipes');
        const snapshot = await getDocs(recipesCollectionRef);
        const recipesContainer = document.getElementById('recipeList');
        recipesContainer.innerHTML = '';
        
        snapshot.forEach(doc => {
            const recipe = doc.data();
            if (!searchTerm || recipe.title.toLowerCase().includes(searchTerm.toLowerCase())) {
                const recipeElement = document.createElement('div');
                recipeElement.classList.add('recipe');
                recipeElement.innerHTML = `
                    <h2>${recipe.title}</h2>
                    <p>${recipe.description}</p>
                    <button class="editButton" data-id="${doc.id}">Edit</button>
                `;
                recipesContainer.appendChild(recipeElement);
            }
        });

        document.querySelectorAll('.editButton').forEach(button => {
            button.addEventListener('click', function() {
                showEditForm(this.getAttribute('data-id'));
            });
        });
    }

    async function showEditForm(docId) {
        const docRef = doc(db, "recipes", docId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            const recipeData = docSnap.data();
            document.getElementById('editRecipeTitle').value = recipeData.title;
            document.getElementById('editRecipeDescription').value = recipeData.description;
            
            const editForm = document.getElementById('editForm');
            editForm.style.display = 'block';
            document.getElementById('saveEditButton').setAttribute('data-id', docId); // Pass the document ID to the save button
        } else {
            console.log("No such document!");
        }
    }
	
	

    fetchRecipes();
</script>

</body>
</html>
