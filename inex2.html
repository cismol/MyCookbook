<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cookbook</title>
    <link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>

<header>
    <h1>My Cookbook</h1>
    <div class="search-bar">
        <input type="text" id="searchInput" class="search-input" placeholder="Search recipes...">
        <button onclick="searchRecipes()" class="search-btn">Search</button>
    </div>
    <nav>
        <a href="#">Home</a>
        <a href="#">Recipes</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
    </nav>
</header>


<div class="container">
    <button class="upload-btn" onclick="toggleUploadForm()">Upload Recipe</button>
    
    <div class="upload-form" id="uploadForm" style="display: none;">
        <form onsubmit="saveRecipe(event)">
            <input type="text" id="recipeTitle" placeholder="Title" required>
            <textarea id="recipeDescription" placeholder="Description" required></textarea>
            <input type="file" id="recipeImage" accept="image/*" required>
            <button type="submit">Save</button>
        </form>
    </div>

    <!-- Example recipes -->
    <div id="exampleRecipes"></div>
    <!-- End of example recipes -->

</div>

<!-- The Modal -->
<div id="editModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Edit Recipe</h2>
    <form id="editForm" onsubmit="updateRecipe(event)">
        <input type="text" id="editTitle" placeholder="Title" required>
        <textarea id="editDescription" placeholder="Description" required></textarea>
        <input type="file" id="editImage" accept="image/*">
        <button type="submit">Update</button>
    </form>
  </div>
</div>

<script>
    // GitHub raw content URL for the recipes file
    const githubRawUrl = 'https://raw.githubusercontent.com/cismol/MyCookbook/master/recipes/test1.json';

    // Load recipes from GitHub when the page loads
    window.onload = function() {
        loadRecipesFromGitHub();
    };

    // Function to search recipes
    function searchRecipes() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const recipes = document.querySelectorAll(".recipe");

        recipes.forEach(recipe => {
            const title = recipe.querySelector("h2").textContent.toLowerCase();
            const description = recipe.querySelector("p").textContent.toLowerCase();
            if (title.includes(searchInput) || description.includes(searchInput)) {
                recipe.style.display = "block";
            } else {
                recipe.style.display = "none";
            }
        });
    }

    // Function to load recipes from GitHub
    function loadRecipesFromGitHub() {
        fetch(githubRawUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch recipes from GitHub');
            }
            return response.json(); // Parse response as JSON
        })
        .then(recipes => {
            displayRecipes(recipes); // Display the loaded recipes
        })
        .catch(error => {
            console.error('Error loading recipes from GitHub:', error);
        });
    }

    // Function to toggle the upload form visibility and reset field values
    function toggleUploadForm() {
        const uploadForm = document.getElementById("uploadForm");
        const titleInput = document.getElementById("recipeTitle");
        const descriptionInput = document.getElementById("recipeDescription");
        const imageInput = document.getElementById("recipeImage");

        if (uploadForm.style.display === "none") {
            // Show the upload form
            uploadForm.style.display = "block";
        } else {
            // Hide the upload form and reset field values
            uploadForm.style.display = "none";
            titleInput.value = ""; // Reset title field
            descriptionInput.value = ""; // Reset description field
            imageInput.value = ""; // Reset image field
        }
    }

    // Function to display recipes on the page
    function displayRecipes(recipes) {
        const container = document.getElementById("exampleRecipes");
        container.innerHTML = ''; // Clear previous recipes

        recipes.forEach(recipe => {
            // Create elements
            const newRecipe = document.createElement("div");
            const title = document.createElement("h2");
            const description = document.createElement("p");
            const buttonContainer = document.createElement("div");
            const editButton = document.createElement("button");
            const deleteButton = document.createElement("button");

            // Set attributes and text content
            newRecipe.classList.add("recipe");
            title.textContent = recipe.title;
            description.textContent = recipe.description;
            editButton.textContent = "Edit";
            deleteButton.textContent = "Delete";

            // Add event listeners
            editButton.addEventListener("click", function() {
                editRecipe(recipe.title, recipe.description, recipe.image);
            });
            deleteButton.addEventListener("click", function() {
                confirmDelete(recipe);
            });

            // Append elements to container
            buttonContainer.classList.add("recipe-buttons");
            buttonContainer.appendChild(editButton);
            buttonContainer.appendChild(deleteButton);

            newRecipe.appendChild(title);
            newRecipe.appendChild(description);
            newRecipe.appendChild(buttonContainer);

            container.appendChild(newRecipe);
        });
    }

    // Function to close the modal
    function closeModal() {
        document.getElementById("editModal").style.display = "none";
    }

    // Function to confirm deletion
    function confirmDelete(recipe) {
        if (confirm("Are you sure you want to delete this recipe?")) {
            deleteRecipeFromGitHub(recipe);
        }
    }

    // Function to delete recipe from the DOM and JSON file
    function deleteRecipeFromGitHub(recipe) {
        // Fetch the recipes file, remove the specific recipe, and save it back
        fetch(githubRawUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch recipes from GitHub');
            }
            return response.json(); // Parse response as JSON
        })
        .then(recipes => {
            const updatedRecipes = recipes.filter(r => r.title !== recipe.title || r.description !== recipe.description);
            // Update JSON file with modified recipes array
            fetch(githubRawUrl, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedRecipes),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update recipes on GitHub');
                }
                console.log('Recipe deleted from GitHub successfully.');
                loadRecipesFromGitHub(); // Reload recipes
            })
            .catch(error => {
                console.error('Error deleting recipe from GitHub:', error);
            });
        })
        .catch(error => {
            console.error('Error fetching recipes from GitHub:', error);
        });
    }

    // Function to edit recipe
    function editRecipe(title, description, image) {
        document.getElementById("editTitle").value = title;
        document.getElementById("editDescription").value = description;
        // Assume you're updating the image URL in the edit modal
        document.getElementById("editImage").value = image;
        document.getElementById("editModal").style.display = "block";
    }

    // Function to update recipe
    function updateRecipe(event) {
        event.preventDefault();
        const editTitleInput = document.getElementById("editTitle").value;
        const editDescriptionInput = document.getElementById("editDescription").value;
        const editImageInput = document.getElementById("editImage").value; // Assuming you're updating the image URL
        
        const updatedRecipe = {
            title: editTitleInput,
            description: editDescriptionInput,
            image: editImageInput
        };

        // Fetch the recipes file, update the specific recipe, and save it back
        fetch(githubRawUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch recipes from GitHub');
            }
            return response.json(); // Parse response as JSON
        })
        .then(recipes => {
            // Find the index of the recipe to update
            const index = recipes.findIndex(r => r.title === updatedRecipe.title && r.description === updatedRecipe.description);
            if (index !== -1) {
                recipes[index] = updatedRecipe; // Update the recipe
                // Save the updated recipes back to GitHub
                fetch(githubRawUrl, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(recipes),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to update recipe on GitHub');
                    }
                    console.log('Recipe updated successfully.');
                    closeModal(); // Close the modal after updating
                    loadRecipesFromGitHub(); // Reload recipes
                })
                .catch(error => {
                    console.error('Error updating recipe on GitHub:', error);
                });
            } else {
                console.error('Recipe not found in JSON file.');
            }
        })
        .catch(error => {
            console.error('Error fetching recipes from GitHub:', error);
        });
    }
</script>

</body>
</html>
