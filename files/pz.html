<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panzerzug - Personalplanung</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#9fb8ff;--muted:#98a2b3;--success:#7ee787}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#041028 0%, #071428 100%);color:#e6eef8;padding:20px}
    .container{max-width:1100px;margin:0 auto}
    h1{margin:0 0 8px;font-size:20px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(3,9,23,.6)}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type=text],select,input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{background:linear-gradient(180deg,var(--accent),#6f97ff);border:none;color:#05203b;padding:8px 10px;border-radius:10px;font-weight:600;cursor:pointer}
    .small{font-size:13px;padding:6px 8px;border-radius:8px}
    .list{max-height:360px;overflow:auto;margin-top:10px}
    .row{display:flex;gap:8px;align-items:center}
    .person{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
    .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03)}
    .controls{display:flex;gap:8px;margin-top:10px}
    .plan{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .tank{padding:10px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);}
    .tank h3{margin:0 0 8px;font-size:15px}
    .slot{display:flex;justify-content:space-between;padding:6px;border-radius:8px;background:rgba(255,255,255,0.01);margin-bottom:6px}
    .warn{color:#ffd2a8}
    .success{color:var(--success)}
    .footer{margin-top:12px;color:var(--muted);font-size:13px}
    .compact{font-size:13px}
    .fixed-flag{font-size:12px;color:#ffd6e0}
    .controls-right{margin-left:auto}
    .flex{display:flex;align-items:center;gap:8px}
    textarea{width:100%;height:120px;background:transparent;color:inherit;border-radius:8px;border:1px solid rgba(255,255,255,0.04);padding:8px}
    .group-title{font-weight:600;margin-top:6px;margin-bottom:4px;font-size:14px;color:var(--accent)}
  </style>
</head>
<body>
  <div class="container">
    <h1>Panzerzug — automatische Personalplanung</h1>
    <p class="compact">Pflege Personal, wähle Anzahl Panzer (UNO..QUATTRO), Det-Größen, fixe Einteilungen und erstelle automatisiert Pläne. Daten werden lokal gespeichert.</p>

    <div class="grid">
      <div class="card">
        <h2 style="margin-top:0">Personalverwaltung</h2>
        <label>Name</label>
        <input id="name" type="text" placeholder="Vorname Nachname" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <select id="role">
            <option value="RiLa">RiLa (Richter/Lader)</option>
            <option value="Fhr">Fhr (Fahrer)</option>
            <option value="WM">WM (Wachtmeister)</option>
            <option value="LT">LT (Leutnant)</option>
          </select>
          <select id="status">
            <option value="available">Verfügbar</option>
            <option value="wache">Wache</option>
            <option value="kueche">Küche</option>
            <option value="urlaub">Urlaub</option>
          </select>
          <button id="add" class="small">hinzufügen</button>
        </div>

        <div class="list" id="peopleList"></div>

        <div class="controls">
          <button id="saveAll" class="small">Speichern</button>
          <button id="exportBtn" class="small">Export JSON</button>
          <button id="importBtn" class="small">Import</button>
          <input id="importArea" placeholder="JSON hier einfügen" style="flex:1;background:transparent;border:1px dashed rgba(255,255,255,0.04);padding:6px;border-radius:8px;color:inherit" />
        </div>

        <p class="footer">Hinweis: Daten werden im Browser (localStorage) gespeichert. Fixe Einteilungen bleiben erhalten und werden bei automatischer Planung priorisiert.</p>
      </div>

      <div class="card">
        <h2 style="margin-top:0">Plan-Einstellungen & Automatik</h2>
        <div class="row">
          <label style="flex:0 0 160px">Anzahl Panzer</label>
          <input id="tankCount" type="number" min="0" max="4" value="2" style="width:80px" />
          <div class="flex" style="margin-left:auto">
            <label class="compact">Aufklärung (Größe)</label>
            <input id="aufkSize" type="number" min="0" value="1" style="width:70px" />
            <label class="compact">Absperr (Größe)</label>
            <input id="absSize" type="number" min="0" value="1" style="width:70px" />
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button id="autoPlan">Automatisch planen</button>
          <button id="clearPlan" class="small">Plan zurücksetzen</button>
          <div style="margin-left:auto">
            <label class="compact">Benutzerdef. Reihenfolge:</label>
            <select id="priority">
              <option value="availableFirst">Verfügbare zuerst</option>
              <option value="fixedFirst">Fixe Einteilungen bevorzugen</option>
            </select>
          </div>
        </div>

        <h3 style="margin-top:12px">Letzter Plan</h3>
        <div id="planArea"></div>

        <h3 style="margin-top:12px">Übersicht Wache / Küche / Urlaub</h3>
        <div id="specialAssignments"></div>

        <h3 style="margin-top:12px">Übersicht unzugeteilter / Warnungen</h3>
        <div id="leftovers"></div>
      </div>
    </div>
  </div>

<script>
// --- Datenmodell & Persistenz ---
const STORAGE_KEY = 'pz_personal_v1';
let state = {
  people: [], // {id,name,role,status,fixedTank:null}
  tankCount: 2,
  aufkSize: 1,
  absSize: 1,
  lastPlan: null
};

function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}
function loadState(){const raw = localStorage.getItem(STORAGE_KEY); if(raw){try{state=JSON.parse(raw);}catch(e){console.error(e);} }}
loadState();

// --- Helpers ---
function uid(){return Math.random().toString(36).slice(2,9)}

// --- UI Bindings ---
const peopleList = document.getElementById('peopleList');
const nameIn = document.getElementById('name');
const roleIn = document.getElementById('role');
const statusIn = document.getElementById('status');
const addBtn = document.getElementById('add');
const saveBtn = document.getElementById('saveAll');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const importArea = document.getElementById('importArea');
const tankCountIn = document.getElementById('tankCount');
const aufkIn = document.getElementById('aufkSize');
const absIn = document.getElementById('absSize');
const autoBtn = document.getElementById('autoPlan');
const planArea = document.getElementById('planArea');
const leftovers = document.getElementById('leftovers');
const clearPlanBtn = document.getElementById('clearPlan');
const specialAssignments = document.getElementById('specialAssignments');

// initialize inputs from state
function refreshInputs(){
  tankCountIn.value = state.tankCount;
  aufkIn.value = state.aufkSize;
  absIn.value = state.absSize;
}

function renderPeople(){peopleList.innerHTML='';
  if(state.people.length===0){peopleList.innerHTML='<p class="compact">Keine Personen angelegt.</p>';return}
  state.people.forEach(p=>{
    const el = document.createElement('div'); el.className='person';
    const left = document.createElement('div');
    left.innerHTML = `<div style="font-weight:600">${p.name}</div><div class="compact">${p.role} • ${p.status}</div>`;
    const right = document.createElement('div');
    right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';

    const fixed = document.createElement('select');
    fixed.innerHTML = '<option value="">nicht fix</option>' + Array.from({length:state.tankCount},(_,i)=>`<option value="${i+1}">Panzer ${i+1}</option>`).join('') + '<option value="aufk">Aufkl.</option><option value="abs">Abspr.</option>';
    fixed.value = p.fixedTank||'';
    fixed.onchange = ()=>{p.fixedTank = fixed.value||null; saveState(); renderPeople()}
    right.appendChild(fixed);

    const del = document.createElement('button'); del.textContent='✕'; del.title='Löschen'; del.onclick=()=>{state.people = state.people.filter(x=>x.id!==p.id); saveState(); renderPeople()}
    right.appendChild(del);

    el.appendChild(left); el.appendChild(right);
    peopleList.appendChild(el);
  })
}

addBtn.onclick = ()=>{
  const name = nameIn.value.trim(); if(!name) return alert('Bitte Namen eingeben');
  const role = roleIn.value; const status = statusIn.value;
  state.people.push({id:uid(),name,role,status,fixedTank:null});
  nameIn.value=''; save
